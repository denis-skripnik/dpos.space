<!DOCTYPE html>
<html lang="ru">
<head>
	<meta charset="utf-8">
	<title>Hello world</title>
	<meta name="description" content="">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
</head>

<body><script src="https://cdnjs.cloudflare.com/ajax/libs/sjcl/1.0.8/sjcl.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/viz-world-js@latest/dist/viz.min.js"></script>
<form id="adsf" class="generated-form">
<p>
<label>
asdf<br>
<input type="text" name="field" value="value"> <br>
</label>
</p>

<fieldset>
<legend>level1</legend>
<p>
<label>
inner1<br>
<input type="text" name="level1[inner1]" value=""> <br>
</label>
</p>

<fieldset>
<legend>level2edited</legend>
<p>
<label>
inner2<br>
<input type="text" name="level1[level2edited][inner2edited]" value="inner2"> <br>
</label>
</p>
</fieldset>
</fieldset>

<p><button>Отправить</button></p>
</form>
<script>!function(){function a(a){for(var b,c=[],d=0;d<a.elements.length;d++)if(b=a.elements[d],b.name&&!b.disabled&&"file"!==b.type&&"reset"!==b.type&&"submit"!==b.type&&"button"!==b.type)if("select-multiple"===b.type)for(var e=0;e<b.options.length;e++)b.options[e].selected&&c.push(encodeURIComponent(b.name)+"="+encodeURIComponent(b.options[e].value));else("checkbox"!==b.type&&"radio"!==b.type||b.checked)&&c.push(encodeURIComponent(b.name)+"="+encodeURIComponent(b.value));return c.join("&")}function b(){const a=["wss://viz.lexai.host","wss://solox.world/ws"];let b=localStorage.getItem("node")||a[0];const c=Math.max(a.indexOf(b),0);const d=c=>(c>=a.length&&(c=0),0>=a.length?void alert("no working nodes found"):void(b=a[c],viz.config.set("websocket",b),viz.api.getDynamicGlobalPropertiesAsync().then(()=>{console.log("found working node",b),localStorage.setItem("node",b)}).catch(a=>{console.log("connection error",b,a),d(c+1)})));d(c)}function c(a){if(localStorage.getItem("login")&&localStorage.getItem("PostingKey"))viz_login=localStorage.getItem("login"),posting_key=sjcl.decrypt(viz_login+"_postingKey",localStorage.getItem("PostingKey"));else if(sessionStorage.getItem("login")&&sessionStorage.getItem("PostingKey"))viz_login=sessionStorage.getItem("login"),posting_key=sjcl.decrypt(viz_login+"_postingKey",sessionStorage.getItem("PostingKey"));else{document.getElementById(a)&&(document.getElementById(a).style.display="none");var b=document.createElement("div");b.innerHTML="<form id=\"auth_form\" action=\"index.html\" method=\"GET\"><p class=\"auth_title\"><strong>\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430 \u0430\u0432\u0442\u043E\u0440\u0438\u0437\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044C</strong></p><p><input type=\"text\" id=\"this_login\" name=\"viz_login\" placeholder=\"\u0412\u0430\u0448 \u043B\u043E\u0433\u0438\u043D\"></p><p><input type=\"password\" name=\"posting\" id=\"this_posting\" placeholder=\"\u041F\u0440\u0438\u0432\u0430\u0442\u043D\u044B\u0439 \u043F\u043E\u0441\u0442\u0438\u043D\u0433 \u043A\u043B\u044E\u0447\"></p><p><input type=\"submit\" value=\"\u0412\u043E\u0439\u0442\u0438\"></p></form>",document.getElementById(a).parentNode.insertAdjacentElement("beforeend",b),document.getElementById("auth_form").onsubmit=function(b){b.preventDefault(),d(a)}}}async function d(a){let b=document.getElementById("this_login").value,c=document.getElementById("this_posting").value;if(localStorage.getItem("PostingKey"))var d=sjcl.decrypt(b+"_postingKey",localStorage.getItem("PostingKey"));else if(sessionStorage.getItem("PostingKey"))var d=sjcl.decrypt(b+"_postingKey",sessionStorage.getItem("PostingKey"));else var d=c;var e=viz.auth.isWif(d);if(!0===e){const a=await viz.api.getAccountsAsync([b]),e=viz.auth.wifToPublic(d);let f=[];if(0<a.length)for(key of a[0].posting.key_auths)f.push(key[0]);else window.alert("\u0412\u0435\u0440\u043E\u044F\u0442\u043D\u043E, \u0430\u043A\u043A\u0430\u0443\u043D\u0442 \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442. \u041F\u0440\u043E\u0441\u044C\u0431\u0430 \u043F\u0440\u043E\u0432\u0435\u0440\u0438\u0442\u044C \u0432\u0432\u0435\u0434\u0451\u043D\u043D\u044B\u0439 \u043B\u043E\u0433\u0438\u043D.");f.includes(e)?(localStorage.setItem("login",b),localStorage.setItem("PostingKey",sjcl.encrypt(b+"_postingKey",c)),sessionStorage.setItem("login",b),sessionStorage.setItem("PostingKey",sjcl.encrypt(b+"_postingKey",c)),viz_login=b,posting_key=d):0===a.length?window.alert("\u0410\u043A\u043A\u0430\u0443\u043D\u0442 \u043D\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442. \u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u043F\u0440\u043E\u0432\u0435\u0440\u044C\u0442\u0435 \u0435\u0433\u043E"):window.alert("\u041F\u043E\u0441\u0442\u0438\u043D\u0433 \u043A\u043B\u044E\u0447 \u043D\u0435 \u0441\u043E\u043E\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043F\u0440\u0435\u043D\u0430\u0434\u043B\u0435\u0436\u0430\u0449\u0435\u043C\u0443 \u0430\u043A\u043A\u0430\u0443\u043D\u0442\u0443.")}else window.alert("\u041F\u043E\u0441\u0442\u0438\u043D\u0433 \u043A\u043B\u044E\u0447 \u0438\u043C\u0435\u0435\u0442 \u043D\u0435\u0432\u0435\u0440\u043D\u044B\u0439 \u0444\u043E\u0440\u043C\u0430\u0442. \u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u043F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437.");viz_login||posting_key?(document.getElementById(a)&&(document.getElementById(a).style.display="block"),document.getElementById("auth_form").remove()):alert("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0430\u0432\u0442\u043E\u0440\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u0442\u044C\u0441\u044F \u0441 \u0442\u0435\u043A\u0443\u0449\u0435\u0439 \u043F\u0430\u0440\u043E\u0439 \u043B\u043E\u0433\u0438\u043D/\u043A\u043B\u044E\u0447")}var e=document.querySelector(".generated-form").id;document.querySelector(".generated-form").querySelector("button").disabled=!0;var f=setTimeout(function a(){window.hasOwnProperty("viz")?(console.log("done"),b(),c(e),document.querySelector(".generated-form").querySelector("button").disabled=!1):(console.log("wait"),f=setTimeout(a,50))},0);document.querySelector(".generated-form").onsubmit=function(b){b.preventDefault(),this.querySelector("button").disabled=!0;var c=new XMLHttpRequest;c.open("POST","json_encode.php"),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),c.onload=function(){return 200===c.status?void(console.log(c.responseText),viz.broadcast.custom(posting_key,[],[viz_login],document.querySelector(".generated-form").id,c.responseText,function(a,b){a?alert("\u041E\u0448\u0438\u0431\u043A\u0430: "+a):(alert("\u041E\u043A. custom \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D"),console.log(b)),document.querySelector(".generated-form").querySelector("button").disabled=!1})):void alert("Request failed.  Returned status of "+c.status)},c.send(a(document.querySelector(".generated-form")))}}()</script></body>
</html>